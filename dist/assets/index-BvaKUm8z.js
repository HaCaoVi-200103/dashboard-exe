import{v as k,r as c,a as A,j as e,x as E}from"./index-CqkrYb4u.js";import{M as T,R as O,T as U,a as $,P as D,b as L}from"./index-rvcLEq5v.js";import{D as _,R,I as z,a as N}from"./Dragger-C2j9QotT.js";import{i as B,F as b,s as h,I as w,R as Y}from"./customize-CACpNBRU.js";import{B as v}from"./index-BHPA9aJO.js";import{S as G}from"./Skeleton-CU0d_ayr.js";import"./index-ov-qCStI.js";import"./CloseOutlined-Dz1priRJ.js";import"./index-CXjsHQYd.js";import"./index-Dt8VRAac.js";const q=async(d,n)=>{const o=`/api/v1/list-blog?current=${d}&pageSize=${n}`;return(await B.get(o)).data},V=async d=>(await B.post("/api/v1/create-blog",d)).data,W=async d=>{const n=`/api/v1/delete-blog/${d}`;return(await B.delete(n)).data},J=async(d,n)=>{const o=`/api/v1/update-blog/${d}`;return(await B.put(o,n)).data},H=d=>{const{isModalOpen:n,setIsModalOpen:o}=d,{refreshBlog:a,setRefreshBlog:S}=k(),[x]=b.useForm(),[g,C]=c.useState(!1),[j,p]=c.useState([]),m=c.useRef(!1),I=()=>{x.resetFields(),C(!1),o(!1)},y=async t=>{try{C(!0);const r={title:t.title,images:j,description:t.description};console.log(r);const u=await V(r);if(u.statusCode===201){h.success({message:u.message}),C(!1),x.resetFields(),S(!a),o(!1);return}h.success({message:u.message})}catch(r){console.log(r)}},f=t=>{if(console.log("Upload event:",t),Array.isArray(t))return t;const r=(t==null?void 0:t.fileList)||[];return r.length>6?(m.current||(h.error({message:"You can only upload up to 6 images!"}),m.current=!0),p([]),x.resetFields(["pro_picture"]),[]):(m.current=!1,r)},P={action:"https://be-exe-joyfull-letter.vercel.app/api/v1/upload-multiple-file",method:"POST",name:"fileList",multiple:!0,listType:"picture",maxCount:void 0,accept:".jpg,.jpeg,.png",withCredentials:!0,headers:{authorization:`Bearer ${A.get("token")}`},beforeUpload:(t,r)=>r.length>6?(m.current||(h.error({message:"You can only upload up to 6 images!"}),m.current=!0),p([]),x.resetFields(["pro_picture"]),!1):(m.current=!1,!0),onChange(t){if(t.file.status!=="uploading"&&console.log(t.file,t.fileList),t.file.status==="done"){const r=t.file.response.data;p([...j,...r])}else t.file.status==="error"&&h.error({message:`${t.file.name} file upload failed.`})}};return e.jsx("div",{children:e.jsx(T,{style:{top:50},title:"Add Blog",open:n,onOk:()=>x.submit(),onCancel:()=>I(),maskClosable:!1,loading:g,children:e.jsxs(b,{name:"basic",onFinish:y,layout:"vertical",form:x,children:[e.jsx(b.Item,{hasFeedback:!0,label:"Title",name:"title",rules:[{required:!0,message:"Please input your category name!"}],children:e.jsx(w,{})}),e.jsx(b.Item,{name:"pro_picture",label:"Picture",valuePropName:"fileList",getValueFromEvent:f,extra:"Maximum 6 picture. Must be .jpg, .png, .jpeg",rules:[{validator:(t,r)=>r&&r.length>0?r[0].type==="image/png"||r[0].type==="image/jpeg"?Promise.resolve():Promise.reject(new Error("You can only upload PNG or JPG images!")):Promise.reject(new Error("Please upload an image!"))}],children:e.jsx(_,{height:100,...P,children:e.jsx(v,{icon:e.jsx(R,{}),children:"Click to upload"})})}),e.jsx(b.Item,{label:"Description",name:"description",rules:[{required:!0,message:"Please input your product description!"}],children:e.jsx(w.TextArea,{rows:3})})]})})})},K=d=>{const{isUpdateModalOpen:n,setIsUpdateModalOpen:o,data:a}=d,{refreshBlog:S,setRefreshBlog:x}=k(),[g]=b.useForm(),[C,j]=c.useState(!1),[p,m]=c.useState([]),[I,y]=c.useState([]),f=c.useRef(!1);c.useEffect(()=>{a&&m(a.images)},[a]);const P=()=>{g.resetFields(),j(!1),o(!1)},t=async s=>{try{const i=[...p,...I],M={title:s.title,description:s.description,images:i};j(!0);const F=await J(a==null?void 0:a._id,M);if(F.statusCode===200){h.success({message:F.message}),j(!1),g.resetFields(),x(!S),o(!1);return}return o(!1),h.error({message:F.message})}catch(i){console.log(i)}},r=s=>{if(console.log("Upload event:",s),Array.isArray(s))return s;const i=(s==null?void 0:s.fileList)||[];return i.length>6?(f.current||(h.error({message:"You can only upload up to 6 images!"}),f.current=!0),y([]),g.resetFields(["pro_picture"]),[]):(f.current=!1,i)},u={action:"https://be-exe-joyfull-letter.vercel.app/api/v1/upload-multiple-file",method:"POST",name:"fileList",multiple:!0,listType:"picture",maxCount:void 0,accept:".jpg,.jpeg,.png",withCredentials:!0,headers:{authorization:`Bearer ${A.get("token")}`},beforeUpload:(s,i)=>i.length>6?(f.current||(h.error({message:"You can only upload up to 6 images!"}),f.current=!0),y([]),g.resetFields(["pro_picture"]),!1):(f.current=!1,!0),onChange(s){if(s.file.status!=="uploading"&&console.log(s.file,s.fileList),s.file.status==="done"){const i=s.file.response.data;y([...I,...i])}else s.file.status==="error"&&h.error({message:`${s.file.name} file upload failed.`})}};c.useEffect(()=>{g.setFieldValue("title",a==null?void 0:a.title),g.setFieldValue("description",a==null?void 0:a.description)},[n,a]);const l=s=>{m(p.filter(i=>i!==s))};return e.jsx("div",{children:e.jsx(T,{style:{top:50},title:"Update product",open:n,onCancel:()=>P(),maskClosable:!1,footer:[e.jsx(v,{onClick:()=>P(),children:"Cancel"},"back"),e.jsx(v,{type:"primary",loading:C,onClick:()=>g.submit(),children:"Save"},"submit")],children:e.jsxs(b,{name:"basic",onFinish:t,layout:"vertical",form:g,children:[e.jsx(b.Item,{hasFeedback:!0,label:"Title",name:"title",rules:[{required:!0,message:"Please input your product name!"}],children:e.jsx(w,{})}),p&&p.length>0&&e.jsx("div",{children:"Current gallery"}),e.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:p&&p.length>0&&p.map((s,i)=>e.jsxs("div",{style:{position:"relative"},children:[e.jsx(z,{style:{width:"100px",height:"100px",objectFit:"cover"},src:s,alt:s}),e.jsx(N,{style:{fontSize:"20px",position:"absolute",top:0,right:0,zIndex:1,background:"white",padding:1,borderTop:"1px solid black",borderRight:"1px solid black"},onClick:()=>l(s)})]},i))}),e.jsx(Y,{children:e.jsx(b.Item,{name:"images",label:"Picture",valuePropName:"fileList",getValueFromEvent:r,extra:"Maximum 6 picture. Must be .jpg, .png, .jpeg",rules:[{validator:(s,i)=>i&&i.length>0?i[0].type==="image/png"||i[0].type==="image/jpeg"?Promise.resolve():Promise.reject(new Error("You can only upload PNG or JPG images!")):Promise.reject(new Error("Please upload an image!"))}],children:e.jsx(_,{height:100,...u,children:e.jsx(v,{icon:e.jsx(R,{}),children:"Click to upload"})})})}),e.jsx(b.Item,{label:"Description",name:"description",rules:[{required:!0,message:"Please input your product description!"}],children:e.jsx(w.TextArea,{})})]})})})},Q=d=>{const{dataSource:n,meta:o}=d,[a,S]=c.useState(n),[x,g]=c.useState(o),[C,j]=c.useState(!1),[p,m]=c.useState(!1),[I,y]=c.useState(null),{setRefreshBlog:f,refreshBlog:P}=k();c.useEffect(()=>{(async()=>(g(o),S(n)))()},[n,o]);const t=async u=>{try{const l=await W(u);if(l.statusCode===200){f(!P),h.success({message:l.message});return}h.error({message:l.message})}catch(l){console.log(l)}},r=[{title:"Title",dataIndex:"title",key:"pro_name"},{title:"Image",dataIndex:"images",key:"images",render:u=>e.jsx("div",{style:{display:"flex",gap:10},children:u&&u.length>0&&u.map(l=>e.jsx(z,{style:{width:"50px",height:"50px"},src:l}))})},{title:"Description",dataIndex:"description",key:"description",render:u=>e.jsx("div",{style:{display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden",textAlign:"justify"},children:u})},{title:"Action",dataIndex:"_id",key:"_id",render:(u,l)=>e.jsxs("div",{style:{display:"flex",gap:20,justifyContent:"start"},children:[e.jsx($,{style:{fontSize:20},onClick:()=>{m(!0),y(l)}}),e.jsx(D,{title:"Are you sure delete category?",onConfirm:()=>t(l._id),cancelText:"No",children:e.jsx(L,{style:{fontSize:20},twoToneColor:"#F04770"})})]})}];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20,fontWeight:600,fontSize:20},children:[e.jsx("span",{children:"Manage Blog"}),e.jsxs(v,{onClick:()=>j(!0),children:[e.jsx(O,{}),e.jsx("span",{children:"Add New"})]})]}),e.jsx(U,{columns:r,dataSource:a,meta:x}),e.jsx(H,{isModalOpen:C,setIsModalOpen:j}),e.jsx(K,{data:I,isUpdateModalOpen:p,setIsUpdateModalOpen:m})]})},ie=()=>{const[d]=E(),n=d.get("current")||"1",o=d.get("pageSize")||"5",[a,S]=c.useState([]),[x,g]=c.useState({current:1,pageSize:10,total:1}),{refreshBlog:C}=k(),[j,p]=c.useState(!1);return c.useEffect(()=>{(async()=>{var I,y,f,P,t,r,u;try{p(!0);const l=await q(+n,+o);if(p(!1),l.statusCode!==200)return h.warning({message:"Can't take data category"});S(((I=l.data)==null?void 0:I.result)||[]),g({current:((f=(y=l.data)==null?void 0:y.meta)==null?void 0:f.current)||1,pageSize:((t=(P=l.data)==null?void 0:P.meta)==null?void 0:t.pageSize)||10,total:((u=(r=l.data)==null?void 0:r.meta)==null?void 0:u.total)||1})}catch(l){console.log(l)}})()},[n,o,C]),j?e.jsx(G,{}):e.jsx("div",{children:e.jsx(Q,{metaDefault:{current:+n,LIMIT:+o},dataSource:a||[],meta:x})})};export{ie as default};
